stages:
  - test
  - package
  - build
  #  - deploy

  before_script:
    - docker stop petclinic_run
    - chmod +x mvnw

 # after_script:
 #   - docker-compose down
  #  - docker-compose up -d



  Test project:
    stage: test
    only:
      - merge_requests
      - 89-devops
    script:
      - ./mvnw test

  Package project:
    stage: package
    script:
      - ./mvnw package -Dmaven.test.skip=true
    only:
      - merge_requests
      - 89-devops
    artifacts:
      paths:
        - web/target/*.jar
      expire_in: 3 days

  Build project:
    stage: build
    only:
      - merge_requests
      - 89-devops
    script:
      - docker rmi $(docker images -f dangling=true -q) || true
      - docker build -t petclinic:0.0.1 .

  #   Deploy project:
  #     stage: deploy
  #   only:
  #      - merge_requests
  #     - master
  #script:
  #      - docker-compose up -d
